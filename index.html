<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Informações - Slideshow</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        #site-frame { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <iframe id="site-frame" src="" title="Slideshow de Páginas Operacionais"></iframe>

    <script>
        const sites = [
            { nome: "Relógio", url: "https://jpleiria.github.io/Relogio_painel/", tempo: 30000 },
            { nome: "Viaturas", url: "https://app.gescorp.pt/app/quartel/fvd.php?display=VIATU&key=xuvPnG2JEsuVNy%2FEK9%2Ff%2BhkLSOKo%2BBWl%3ADsDe5ZjIOcb9Bg9kQ1zTUBc3gOmptb4%2B", tempo: 20000 },
            { nome: "Bombeiros", url: "https://app.gescorp.pt/app/quartel/fvd.php?display=BOMBE&key=xuvPnG2JEsuVNy%2FEK9%2Ff%2BhkLSOKo%2BBWl%3ADsDe5ZjIOcb9Bg9kQ1zTUBc3gOmptb4%2B", tempo: 15000 }
        ];

        const URL_TROCA_TURNO = "https://jpleiria.github.io/troca_turno/";
        let indiceAtual = 0;
        let timeoutSlideshow;
        const iframe = document.getElementById('site-frame');

        function gerenciarSlideshow() {
            const agora = new Date();
            const hora = agora.getHours();
            const minuto = agora.getMinutes();

            // Prioridade máxima: Troca de Turno
            if ((hora === 8 || hora === 20) && minuto === 0) {
                if (iframe.src !== URL_TROCA_TURNO) {
                    console.log("Iniciando Troca de Turno IMEDIATA.");
                    iframe.src = URL_TROCA_TURNO;
                    clearTimeout(timeoutSlideshow); // Para o slideshow normal
                }
            } else {
                // Se não é hora de troca, executa o carrossel normal
                executarCarrossel();
            }
        }

        function executarCarrossel() {
            const siteAtual = sites[indiceAtual];
            
            // Só troca se não estiver já no site certo (evita refresh desnecessário)
            if (iframe.src !== siteAtual.url) {
                console.log(`Carregando slide: ${siteAtual.nome}`);
                iframe.src = siteAtual.url;
            }

            indiceAtual = (indiceAtual + 1) % sites.length;
            
            // Agenda o próximo slide
            clearTimeout(timeoutSlideshow);
            timeoutSlideshow = setTimeout(gerenciarSlideshow, siteAtual.tempo);
        }

        // Verifica a cada 1 segundo se bateu o horário de Troca de Turno
        // Isso garante precisão absoluta no horário
        setInterval(() => {
            const agora = new Date();
            if (agora.getMinutes() === 0 && agora.getSeconds() === 0 && (agora.getHours() === 8 || agora.getHours() === 20)) {
                gerenciarSlideshow();
            }
        }, 1000);

        // Início imediato
        gerenciarSlideshow();
    </script>
</body>
</html>